<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç™»å½•æ³¨å†ŒåŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section h2 {
            color: #c9483c;
            border-bottom: 2px solid #c9483c;
            padding-bottom: 10px;
        }
        .test-item {
            margin: 15px 0;
            padding: 10px;
            background: #f8f9fa;
            border-left: 4px solid #c9483c;
        }
        .status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        .status.success { background: #d4edda; color: #155724; }
        .status.error { background: #f8d7da; color: #721c24; }
        .status.info { background: #d1ecf1; color: #0c5460; }
        button {
            background: #c9483c;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #b03d33;
        }
        .data-display {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }
        .nav-links {
            text-align: center;
            margin: 20px 0;
        }
        .nav-links a {
            display: inline-block;
            margin: 0 10px;
            padding: 10px 20px;
            background: #c9483c;
            color: white;
            text-decoration: none;
            border-radius: 4px;
        }
        .nav-links a:hover {
            background: #b03d33;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª ç½‘æ˜“äº‘é˜…è¯» - ç™»å½•æ³¨å†ŒåŠŸèƒ½æµ‹è¯•</h1>
    
    <div class="nav-links">
        <a href="index.html">è¿”å›é¦–é¡µ</a>
        <a href="login.html">ç™»å½•é¡µé¢</a>
        <a href="register.html">æ³¨å†Œé¡µé¢</a>
    </div>

    <div class="test-section">
        <h2>ğŸ“Š å½“å‰çŠ¶æ€æ£€æŸ¥</h2>
        <div class="test-item">
            <strong>ç™»å½•çŠ¶æ€ï¼š</strong>
            <span id="loginStatus" class="status info">æ£€æŸ¥ä¸­...</span>
        </div>
        <div class="test-item">
            <strong>å½“å‰ç”¨æˆ·ï¼š</strong>
            <span id="currentUser">-</span>
        </div>
        <div class="test-item">
            <strong>å·²æ³¨å†Œç”¨æˆ·æ•°é‡ï¼š</strong>
            <span id="userCount">0</span>
        </div>
        <button onclick="refreshStatus()">ğŸ”„ åˆ·æ–°çŠ¶æ€</button>
        <button onclick="clearAllData()">ğŸ—‘ï¸ æ¸…é™¤æ‰€æœ‰æ•°æ®</button>
    </div>

    <div class="test-section">
        <h2>ğŸ‘¥ å·²æ³¨å†Œç”¨æˆ·åˆ—è¡¨</h2>
        <div id="userList" class="data-display">æš‚æ— æ³¨å†Œç”¨æˆ·</div>
        <button onclick="showUserList()">ğŸ“‹ æ˜¾ç¤ºç”¨æˆ·åˆ—è¡¨</button>
        <button onclick="addTestUser()">â• æ·»åŠ æµ‹è¯•ç”¨æˆ·</button>
    </div>

    <div class="test-section">
        <h2>ğŸ” ç™»å½•çŠ¶æ€ä¿¡æ¯</h2>
        <div id="loginInfo" class="data-display">æœªç™»å½•</div>
        <button onclick="showLoginInfo()">ğŸ“„ æ˜¾ç¤ºç™»å½•ä¿¡æ¯</button>
        <button onclick="simulateLogin()">ğŸ”‘ æ¨¡æ‹Ÿç™»å½•</button>
        <button onclick="logout()">ğŸšª é€€å‡ºç™»å½•</button>
    </div>

    <div class="test-section">
        <h2>ğŸ§ª åŠŸèƒ½æµ‹è¯•</h2>
        <div class="test-item">
            <button onclick="testRegistration()">æµ‹è¯•æ³¨å†ŒåŠŸèƒ½</button>
            <button onclick="testLogin()">æµ‹è¯•ç™»å½•åŠŸèƒ½</button>
            <button onclick="testValidation()">æµ‹è¯•è¡¨å•éªŒè¯</button>
        </div>
        <div id="testResults" class="data-display">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•...</div>
    </div>

    <div class="test-section">
        <h2>ğŸ›’ è´­ç‰©è½¦åŠŸèƒ½æµ‹è¯•</h2>
        <div class="test-item">
            <h4>ğŸ¯ æµ‹è¯•åœºæ™¯ï¼š</h4>
            <ol>
                <li><strong>æœªç™»å½•çŠ¶æ€æµ‹è¯•ï¼š</strong>
                    <ul>
                        <li>ç‚¹å‡»é¦–é¡µçš„"ç«‹å³è´­ä¹°"æŒ‰é’® â†’ åº”æ˜¾ç¤ºç™»å½•æç¤º</li>
                        <li>åœ¨è¯¦æƒ…é¡µç‚¹å‡»"åŠ å…¥è´­ç‰©è½¦" â†’ åº”æ˜¾ç¤ºç™»å½•æç¤º</li>
                        <li>è®¿é—®è´­ç‰©è½¦é¡µé¢ â†’ åº”æ˜¾ç¤ºç©ºè´­ç‰©è½¦æˆ–ç™»å½•æç¤º</li>
                    </ul>
                </li>
                <li><strong>ç™»å½•çŠ¶æ€æµ‹è¯•ï¼š</strong>
                    <ul>
                        <li>ç™»å½•åç‚¹å‡»"ç«‹å³è´­ä¹°" â†’ æ­£å¸¸è·³è½¬åˆ°è¯¦æƒ…é¡µ</li>
                        <li>åœ¨è¯¦æƒ…é¡µæ·»åŠ å•†å“åˆ°è´­ç‰©è½¦ â†’ æˆåŠŸæ·»åŠ </li>
                        <li>ä¸åŒç”¨æˆ·çš„è´­ç‰©è½¦åº”è¯¥æ˜¯ç‹¬ç«‹çš„</li>
                    </ul>
                </li>
                <li><strong>è´­ç‰©è½¦è¿ç§»æµ‹è¯•ï¼š</strong>
                    <ul>
                        <li>æœªç™»å½•æ—¶æ·»åŠ å•†å“ï¼ˆä¼šæç¤ºç™»å½•ï¼‰</li>
                        <li>ç™»å½•ååº”è¯¥çœ‹åˆ°è´­ç‰©è½¦è¿ç§»æç¤º</li>
                    </ul>
                </li>
            </ol>
        </div>
        <div class="test-item">
            <button onclick="testCartLogin()">ğŸ§ª æµ‹è¯•è´­ç‰©è½¦ç™»å½•éªŒè¯</button>
            <button onclick="testCartMigration()">ğŸ”„ æµ‹è¯•è´­ç‰©è½¦è¿ç§»</button>
            <button onclick="showCartData()">ğŸ“Š æ˜¾ç¤ºè´­ç‰©è½¦æ•°æ®</button>
        </div>
        <div id="cartTestResults" class="data-display">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•...</div>
    </div>

    <div class="test-section">
        <h2>ğŸ“ æµ‹è¯•è¯´æ˜</h2>
        <div class="test-item">
            <h4>ğŸ¯ æµ‹è¯•æ­¥éª¤ï¼š</h4>
            <ol>
                <li>ç‚¹å‡»"æ³¨å†Œé¡µé¢"é“¾æ¥ï¼Œæ³¨å†Œä¸€ä¸ªæ–°ç”¨æˆ·</li>
                <li>æ³¨å†ŒæˆåŠŸåä¼šè·³è½¬åˆ°ç™»å½•é¡µé¢</li>
                <li>ä½¿ç”¨æ³¨å†Œçš„è´¦å·ä¿¡æ¯ç™»å½•</li>
                <li>ç™»å½•æˆåŠŸåä¼šè·³è½¬åˆ°é¦–é¡µ</li>
                <li>åœ¨é¦–é¡µé¡¶éƒ¨åº”è¯¥æ˜¾ç¤º"ä½ å¥½ï¼Œç”¨æˆ·å"</li>
                <li>ç‚¹å‡»"é€€å‡ºç™»å½•"å¯ä»¥é€€å‡º</li>
            </ol>
        </div>
        <div class="test-item">
            <h4>ğŸ“‹ éªŒè¯ç ä¿¡æ¯ï¼š</h4>
            <p>æ³¨å†Œæ—¶éªŒè¯ç å›ºå®šä¸ºï¼š<strong>123456</strong></p>
        </div>
        <div class="test-item">
            <h4>ğŸ” è°ƒè¯•ä¿¡æ¯ï¼š</h4>
            <p>æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·(F12)æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—è·å–è¯¦ç»†ä¿¡æ¯</p>
        </div>
    </div>

    <script src="js/auth.js"></script>
    <script>
        // åˆ·æ–°çŠ¶æ€æ˜¾ç¤º
        function refreshStatus() {
            const loginStatus = checkLoginStatus();
            const registeredUsers = getRegisteredUsers();
            
            // æ›´æ–°ç™»å½•çŠ¶æ€
            const statusEl = document.getElementById('loginStatus');
            const userEl = document.getElementById('currentUser');
            const countEl = document.getElementById('userCount');
            
            if (loginStatus.isLoggedIn) {
                statusEl.textContent = 'å·²ç™»å½•';
                statusEl.className = 'status success';
                userEl.textContent = loginStatus.user.username || loginStatus.user.email;
            } else {
                statusEl.textContent = 'æœªç™»å½•';
                statusEl.className = 'status error';
                userEl.textContent = '-';
            }
            
            countEl.textContent = registeredUsers.length;
        }

        // æ˜¾ç¤ºç”¨æˆ·åˆ—è¡¨
        function showUserList() {
            const users = getRegisteredUsers();
            const userListEl = document.getElementById('userList');
            
            if (users.length === 0) {
                userListEl.textContent = 'æš‚æ— æ³¨å†Œç”¨æˆ·';
                return;
            }
            
            let listText = 'å·²æ³¨å†Œç”¨æˆ·åˆ—è¡¨ï¼š\n\n';
            users.forEach((user, index) => {
                listText += `${index + 1}. ç”¨æˆ·åï¼š${user.username}\n`;
                listText += `   é‚®ç®±ï¼š${user.email}\n`;
                listText += `   æ‰‹æœºå·ï¼š${user.phone}\n`;
                listText += `   æ³¨å†Œæ—¶é—´ï¼š${new Date(user.registerTime).toLocaleString()}\n\n`;
            });
            
            userListEl.textContent = listText;
        }

        // æ˜¾ç¤ºç™»å½•ä¿¡æ¯
        function showLoginInfo() {
            const loginStatus = checkLoginStatus();
            const infoEl = document.getElementById('loginInfo');
            
            if (loginStatus.isLoggedIn) {
                const info = `ç™»å½•çŠ¶æ€ï¼šå·²ç™»å½•
ç”¨æˆ·ä¿¡æ¯ï¼š
- ç”¨æˆ·åï¼š${loginStatus.user.username || 'æœªè®¾ç½®'}
- é‚®ç®±ï¼š${loginStatus.user.email || 'æœªè®¾ç½®'}
- æ‰‹æœºå·ï¼š${loginStatus.user.phone || 'æœªè®¾ç½®'}
- ç™»å½•æ—¶é—´ï¼š${new Date(loginStatus.user.loginTime).toLocaleString()}

å­˜å‚¨ä¿¡æ¯ï¼š
- Tokenï¼š${localStorage.getItem('userToken')}
- è®°ä½ç™»å½•ï¼š${localStorage.getItem('rememberLogin') || 'å¦'}`;
                infoEl.textContent = info;
            } else {
                infoEl.textContent = 'å½“å‰æœªç™»å½•';
            }
        }

        // æ¸…é™¤æ‰€æœ‰æ•°æ®
        function clearAllData() {
            if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰ç”¨æˆ·æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                localStorage.removeItem('registeredUsers');
                localStorage.removeItem('userToken');
                localStorage.removeItem('userInfo');
                localStorage.removeItem('rememberLogin');
                alert('æ‰€æœ‰æ•°æ®å·²æ¸…é™¤ï¼');
                refreshStatus();
                showUserList();
                showLoginInfo();
            }
        }

        // æ·»åŠ æµ‹è¯•ç”¨æˆ·
        function addTestUser() {
            const users = getRegisteredUsers();
            const testUser = {
                username: 'æµ‹è¯•ç”¨æˆ·' + (users.length + 1),
                email: `test${users.length + 1}@example.com`,
                phone: `1391234567${users.length}`,
                password: '123456',
                registerTime: new Date().toISOString()
            };
            
            users.push(testUser);
            saveRegisteredUsers(users);
            alert('æµ‹è¯•ç”¨æˆ·æ·»åŠ æˆåŠŸï¼');
            refreshStatus();
            showUserList();
        }

        // æ¨¡æ‹Ÿç™»å½•
        function simulateLogin() {
            const users = getRegisteredUsers();
            if (users.length === 0) {
                alert('æ²¡æœ‰å¯ç”¨çš„ç”¨æˆ·ï¼Œè¯·å…ˆæ³¨å†Œæˆ–æ·»åŠ æµ‹è¯•ç”¨æˆ·ï¼');
                return;
            }
            
            const user = users[0];
            const userInfo = {
                username: user.username,
                email: user.email,
                phone: user.phone,
                loginTime: new Date().toISOString()
            };
            
            localStorage.setItem('userToken', 'token_' + Date.now());
            localStorage.setItem('userInfo', JSON.stringify(userInfo));
            
            alert(`æ¨¡æ‹Ÿç™»å½•æˆåŠŸï¼ç”¨æˆ·ï¼š${user.username}`);
            refreshStatus();
            showLoginInfo();
        }

        // æµ‹è¯•æ³¨å†ŒåŠŸèƒ½
        function testRegistration() {
            const results = document.getElementById('testResults');
            let testLog = 'ğŸ§ª æ³¨å†ŒåŠŸèƒ½æµ‹è¯•ç»“æœï¼š\n\n';
            
            // æµ‹è¯•ç”¨æˆ·åéªŒè¯
            testLog += '1. ç”¨æˆ·åéªŒè¯æµ‹è¯•ï¼š\n';
            testLog += `   - ç©ºç”¨æˆ·åï¼š${Auth.validateUsername('', 'test') ? 'âŒ å¤±è´¥' : 'âœ… é€šè¿‡'}\n`;
            testLog += `   - çŸ­ç”¨æˆ·åï¼š${Auth.validateUsername('ab', 'test') ? 'âŒ å¤±è´¥' : 'âœ… é€šè¿‡'}\n`;
            testLog += `   - æ­£å¸¸ç”¨æˆ·åï¼š${Auth.validateUsername('æµ‹è¯•ç”¨æˆ·', 'test') ? 'âœ… é€šè¿‡' : 'âŒ å¤±è´¥'}\n`;
            
            // æµ‹è¯•é‚®ç®±éªŒè¯
            testLog += '\n2. é‚®ç®±éªŒè¯æµ‹è¯•ï¼š\n';
            testLog += `   - æ— æ•ˆé‚®ç®±ï¼š${Auth.validateEmail('invalid', 'test') ? 'âŒ å¤±è´¥' : 'âœ… é€šè¿‡'}\n`;
            testLog += `   - æœ‰æ•ˆé‚®ç®±ï¼š${Auth.validateEmail('test@example.com', 'test') ? 'âœ… é€šè¿‡' : 'âŒ å¤±è´¥'}\n`;
            
            // æµ‹è¯•æ‰‹æœºå·éªŒè¯
            testLog += '\n3. æ‰‹æœºå·éªŒè¯æµ‹è¯•ï¼š\n';
            testLog += `   - æ— æ•ˆæ‰‹æœºå·ï¼š${Auth.validatePhone('123', 'test') ? 'âŒ å¤±è´¥' : 'âœ… é€šè¿‡'}\n`;
            testLog += `   - æœ‰æ•ˆæ‰‹æœºå·ï¼š${Auth.validatePhone('13912345678', 'test') ? 'âœ… é€šè¿‡' : 'âŒ å¤±è´¥'}\n`;
            
            testLog += '\nâœ… æ³¨å†ŒåŠŸèƒ½æµ‹è¯•å®Œæˆï¼';
            results.textContent = testLog;
        }

        // æµ‹è¯•ç™»å½•åŠŸèƒ½
        function testLogin() {
            const results = document.getElementById('testResults');
            let testLog = 'ğŸ”‘ ç™»å½•åŠŸèƒ½æµ‹è¯•ç»“æœï¼š\n\n';
            
            // æµ‹è¯•é»˜è®¤è´¦å·ç™»å½•
            const loginResult1 = Auth.performLogin({
                email: 'test@example.com',
                password: '123456'
            });
            testLog += `1. é»˜è®¤é‚®ç®±ç™»å½•ï¼š${loginResult1.success ? 'âœ… æˆåŠŸ' : 'âŒ å¤±è´¥'}\n`;
            
            const loginResult2 = Auth.performLogin({
                email: '13800138000',
                password: '123456'
            });
            testLog += `2. é»˜è®¤æ‰‹æœºå·ç™»å½•ï¼š${loginResult2.success ? 'âœ… æˆåŠŸ' : 'âŒ å¤±è´¥'}\n`;
            
            // æµ‹è¯•é”™è¯¯å¯†ç 
            const loginResult3 = Auth.performLogin({
                email: 'test@example.com',
                password: 'wrong'
            });
            testLog += `3. é”™è¯¯å¯†ç ç™»å½•ï¼š${loginResult3.success ? 'âŒ å¤±è´¥' : 'âœ… é€šè¿‡'}\n`;
            
            testLog += '\nâœ… ç™»å½•åŠŸèƒ½æµ‹è¯•å®Œæˆï¼';
            results.textContent = testLog;
        }

        // æµ‹è¯•è¡¨å•éªŒè¯
        function testValidation() {
            const results = document.getElementById('testResults');
            let testLog = 'ğŸ“ è¡¨å•éªŒè¯æµ‹è¯•ç»“æœï¼š\n\n';
            
            // æµ‹è¯•å¯†ç éªŒè¯
            testLog += '1. å¯†ç éªŒè¯ï¼š\n';
            testLog += `   - ç©ºå¯†ç ï¼š${Auth.validatePassword('', 'test') ? 'âŒ å¤±è´¥' : 'âœ… é€šè¿‡'}\n`;
            testLog += `   - çŸ­å¯†ç ï¼š${Auth.validatePassword('123', 'test') ? 'âŒ å¤±è´¥' : 'âœ… é€šè¿‡'}\n`;
            testLog += `   - æ­£å¸¸å¯†ç ï¼š${Auth.validatePassword('123456', 'test') ? 'âœ… é€šè¿‡' : 'âŒ å¤±è´¥'}\n`;
            
            // æµ‹è¯•ç¡®è®¤å¯†ç 
            testLog += '\n2. ç¡®è®¤å¯†ç éªŒè¯ï¼š\n';
            testLog += `   - å¯†ç ä¸åŒ¹é…ï¼š${Auth.validateConfirmPassword('123456', '654321', 'test') ? 'âŒ å¤±è´¥' : 'âœ… é€šè¿‡'}\n`;
            testLog += `   - å¯†ç åŒ¹é…ï¼š${Auth.validateConfirmPassword('123456', '123456', 'test') ? 'âœ… é€šè¿‡' : 'âŒ å¤±è´¥'}\n`;
            
            // æµ‹è¯•éªŒè¯ç 
            testLog += '\n3. éªŒè¯ç éªŒè¯ï¼š\n';
            testLog += `   - é”™è¯¯éªŒè¯ç ï¼š${Auth.validateVerifyCode('000000', 'test') ? 'âŒ å¤±è´¥' : 'âœ… é€šè¿‡'}\n`;
            testLog += `   - æ­£ç¡®éªŒè¯ç ï¼š${Auth.validateVerifyCode('123456', 'test') ? 'âœ… é€šè¿‡' : 'âŒ å¤±è´¥'}\n`;
            
            testLog += '\nâœ… è¡¨å•éªŒè¯æµ‹è¯•å®Œæˆï¼';
            results.textContent = testLog;
        }

        // æµ‹è¯•è´­ç‰©è½¦ç™»å½•éªŒè¯
        function testCartLogin() {
            const results = document.getElementById('cartTestResults');
            let testLog = 'ğŸ›’ è´­ç‰©è½¦ç™»å½•éªŒè¯æµ‹è¯•ç»“æœï¼š\n\n';
            
            const loginStatus = checkLoginStatus();
            testLog += `å½“å‰ç™»å½•çŠ¶æ€ï¼š${loginStatus.isLoggedIn ? 'å·²ç™»å½•' : 'æœªç™»å½•'}\n\n`;
            
            if (window.cart) {
                // æµ‹è¯•è´­ç‰©è½¦ç™»å½•æ£€æŸ¥
                const cartLoginStatus = window.cart.checkLoginStatus();
                testLog += `è´­ç‰©è½¦ç™»å½•æ£€æŸ¥ï¼š${cartLoginStatus.isLoggedIn ? 'âœ… å·²ç™»å½•' : 'âŒ æœªç™»å½•'}\n`;
                
                // æµ‹è¯•å­˜å‚¨é”®ç”Ÿæˆ
                const storageKey = window.cart.getCartStorageKey();
                testLog += `è´­ç‰©è½¦å­˜å‚¨é”®ï¼š${storageKey}\n`;
                
                // æµ‹è¯•è´­ç‰©è½¦æ•°æ®åŠ è½½
                const cartItems = window.cart.getItems();
                testLog += `è´­ç‰©è½¦å•†å“æ•°é‡ï¼š${cartItems.length}\n`;
                
                testLog += '\nğŸ“‹ æµ‹è¯•å»ºè®®ï¼š\n';
                if (!loginStatus.isLoggedIn) {
                    testLog += '1. å½“å‰æœªç™»å½•ï¼Œå¯ä»¥æµ‹è¯•ç‚¹å‡»"ç«‹å³è´­ä¹°"æŒ‰é’®\n';
                    testLog += '2. åº”è¯¥ä¼šæ˜¾ç¤ºç™»å½•æç¤ºå¼¹çª—\n';
                    testLog += '3. ç‚¹å‡»"ç«‹å³ç™»å½•"ä¼šè·³è½¬åˆ°ç™»å½•é¡µé¢\n';
                } else {
                    testLog += '1. å½“å‰å·²ç™»å½•ï¼Œå¯ä»¥æ­£å¸¸æ·»åŠ å•†å“åˆ°è´­ç‰©è½¦\n';
                    testLog += '2. è´­ç‰©è½¦æ•°æ®ä¼šä¿å­˜åˆ°ç”¨æˆ·ä¸“å±å­˜å‚¨\n';
                    testLog += '3. å¯ä»¥æµ‹è¯•é€€å‡ºç™»å½•åçš„è´­ç‰©è½¦æ¸…ç†\n';
                }
            } else {
                testLog += 'âŒ è´­ç‰©è½¦ç³»ç»Ÿæœªåˆå§‹åŒ–\n';
            }
            
            testLog += '\nâœ… è´­ç‰©è½¦ç™»å½•éªŒè¯æµ‹è¯•å®Œæˆï¼';
            results.textContent = testLog;
        }

        // æµ‹è¯•è´­ç‰©è½¦è¿ç§»
        function testCartMigration() {
            const results = document.getElementById('cartTestResults');
            let testLog = 'ğŸ”„ è´­ç‰©è½¦è¿ç§»æµ‹è¯•ç»“æœï¼š\n\n';
            
            if (window.cart) {
                // æ£€æŸ¥ä¸´æ—¶è´­ç‰©è½¦
                const guestItems = Utils.storage.get('shopping_cart_guest') || [];
                testLog += `ä¸´æ—¶è´­ç‰©è½¦å•†å“æ•°é‡ï¼š${guestItems.length}\n`;
                
                const loginStatus = checkLoginStatus();
                if (loginStatus.isLoggedIn) {
                    const userCartKey = window.cart.getCartStorageKey();
                    const userItems = Utils.storage.get(userCartKey) || [];
                    testLog += `ç”¨æˆ·è´­ç‰©è½¦å•†å“æ•°é‡ï¼š${userItems.length}\n`;
                    testLog += `ç”¨æˆ·è´­ç‰©è½¦å­˜å‚¨é”®ï¼š${userCartKey}\n`;
                    
                    if (guestItems.length > 0) {
                        testLog += '\nğŸ”„ æ‰§è¡Œè´­ç‰©è½¦è¿ç§»æµ‹è¯•...\n';
                        window.cart.migrateGuestCart();
                        testLog += 'è¿ç§»å®Œæˆï¼Œè¯·æŸ¥çœ‹é¡µé¢æç¤ºä¿¡æ¯\n';
                    } else {
                        testLog += '\nğŸ’¡ æç¤ºï¼šæ²¡æœ‰ä¸´æ—¶è´­ç‰©è½¦æ•°æ®éœ€è¦è¿ç§»\n';
                        testLog += 'å¯ä»¥å…ˆé€€å‡ºç™»å½•ï¼Œæ·»åŠ ä¸€äº›å•†å“åˆ°ä¸´æ—¶è´­ç‰©è½¦ï¼Œå†ç™»å½•æµ‹è¯•è¿ç§»åŠŸèƒ½\n';
                    }
                } else {
                    testLog += '\nğŸ’¡ æç¤ºï¼šå½“å‰æœªç™»å½•ï¼Œæ— æ³•æµ‹è¯•è¿ç§»åŠŸèƒ½\n';
                    testLog += 'è¯·å…ˆç™»å½•åå†æµ‹è¯•è´­ç‰©è½¦è¿ç§»\n';
                }
            } else {
                testLog += 'âŒ è´­ç‰©è½¦ç³»ç»Ÿæœªåˆå§‹åŒ–\n';
            }
            
            testLog += '\nâœ… è´­ç‰©è½¦è¿ç§»æµ‹è¯•å®Œæˆï¼';
            results.textContent = testLog;
        }

        // æ˜¾ç¤ºè´­ç‰©è½¦æ•°æ®
        function showCartData() {
            const results = document.getElementById('cartTestResults');
            let testLog = 'ğŸ“Š è´­ç‰©è½¦æ•°æ®è¯¦æƒ…ï¼š\n\n';
            
            const loginStatus = checkLoginStatus();
            testLog += `ç™»å½•çŠ¶æ€ï¼š${loginStatus.isLoggedIn ? 'å·²ç™»å½•' : 'æœªç™»å½•'}\n`;
            
            if (loginStatus.isLoggedIn) {
                testLog += `å½“å‰ç”¨æˆ·ï¼š${loginStatus.user.username || loginStatus.user.email}\n`;
            }
            
            testLog += '\nğŸ—„ï¸ å­˜å‚¨æ•°æ®ï¼š\n';
            
            // æ˜¾ç¤ºæ‰€æœ‰è´­ç‰©è½¦ç›¸å…³çš„å­˜å‚¨æ•°æ®
            const allKeys = Object.keys(localStorage).filter(key => key.includes('shopping_cart'));
            if (allKeys.length > 0) {
                allKeys.forEach(key => {
                    const data = Utils.storage.get(key) || [];
                    testLog += `${key}: ${data.length} ä»¶å•†å“\n`;
                    if (data.length > 0) {
                        data.forEach((item, index) => {
                            testLog += `  ${index + 1}. ${item.title} (æ•°é‡: ${item.quantity})\n`;
                        });
                    }
                });
            } else {
                testLog += 'æš‚æ— è´­ç‰©è½¦æ•°æ®\n';
            }
            
            // æ˜¾ç¤ºå½“å‰è´­ç‰©è½¦çŠ¶æ€
            if (window.cart) {
                const currentItems = window.cart.getItems();
                testLog += `\nğŸ›’ å½“å‰è´­ç‰©è½¦ï¼š${currentItems.length} ä»¶å•†å“\n`;
                testLog += `æ€»æ•°é‡ï¼š${window.cart.getTotalQuantity()}\n`;
                testLog += `æ€»ä»·æ ¼ï¼š${window.cart.getTotalPrice()}\n`;
            }
            
            results.textContent = testLog;
        }

        // è·å–å·²æ³¨å†Œç”¨æˆ·ï¼ˆå¤åˆ¶auth.jsä¸­çš„å‡½æ•°ï¼‰
        function getRegisteredUsers() {
            try {
                const users = localStorage.getItem('registeredUsers');
                return users ? JSON.parse(users) : [];
            } catch (e) {
                console.error('è·å–æ³¨å†Œç”¨æˆ·åˆ—è¡¨å¤±è´¥:', e);
                return [];
            }
        }

        // ä¿å­˜å·²æ³¨å†Œç”¨æˆ·ï¼ˆå¤åˆ¶auth.jsä¸­çš„å‡½æ•°ï¼‰
        function saveRegisteredUsers(users) {
            try {
                localStorage.setItem('registeredUsers', JSON.stringify(users));
            } catch (e) {
                console.error('ä¿å­˜æ³¨å†Œç”¨æˆ·åˆ—è¡¨å¤±è´¥:', e);
            }
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            refreshStatus();
            showUserList();
            showLoginInfo();
        });
    </script>
</body>
</html> 